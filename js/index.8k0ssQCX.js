import{A as e}from"./auth.BK4hJjr4.js";import{b as a}from"./el-overlay.tDao4uvE.js";import{v as l,T as t}from"./Table.D6HFkYab.js";import{_ as o}from"./Search.vue_vue_type_script_setup_true_lang.Cp_oKFC1.js";import{C as i}from"./index.BQ5aJrVA.js";import{s as r,r as s,e as n,F as u,y as d,A as c,$ as p,b as m,D as v,g as f,ai as g,U as h,c as w,f as y,w as _,aa as b,H as j,ae as k}from"./index.C8pNQb-t.js";import{a as x,_ as R}from"./Form.vue_vue_type_script_lang.DsXMripE.js";import{u as A}from"./useForm.DyIg6q47.js";import{u as C}from"./useValidator.Bj_R0Ps1.js";import{_ as D}from"./Descriptions.vue_vue_type_script_lang.CfyUaxL8.js";import{D as P}from"./index.CNZLOtaJ.js";import{f as I,_ as L}from"./dateUtil.BxX4tQHJ.js";import"./request.DiNQJJBl.js";import"./_initCloneObject.Cqd3kJ-N.js";import"./index.DTfrWyOT.js";import"./debounce.BuPGJDYu.js";/* empty css                 *//* empty css               */import"./el-tooltip.l0sNRNKZ.js";import"./cloneDeep.nDz-k2nn.js";import"./_baseClone.BPfS26kN.js";import"./el-form-item.DurPJSl-.js";import"./el-row.BoE8vcTg.js";import"./_commonjsHelpers.lGe4XDVY.js";const z=r({__name:"roleWrite",props:{currentRow:{type:Object,default:()=>null}},setup(e,{expose:a}){const{required:t}=C(),o=e,i=s(),r=s([]),w=s(!1),y=s([]),_=e=>e?e.map((e=>{var a;let l;return l=1==(null==(a=null==e?void 0:e.children)?void 0:a.length)?e.children[0]:e,{name:l.name,label:l.meta.title,children:_(null==l?void 0:l.children)}})):null;(async()=>{try{w.value=!0,y.value=_(g),o.currentRow.id&&await(async e=>{const a=await getRoleDetailApi(o.currentRow.id),l=a.data.permission.filter((a=>-1==e.findIndex((e=>(null==e?void 0:e.children)&&e.code==a))));!a.code&&l.length&&(r.value=l)})(y.value),await h()}catch(e){}finally{w.value=!1}})();const b=s([{field:"name",label:"角色名称",colProps:{span:24},component:"Input",componentProps:{maxlength:15,showWordLimit:!0}},{field:"remark",label:"备注",colProps:{span:24},component:"Input",componentProps:{type:"textarea",rows:4,maxlength:100,showWordLimit:!0}},{field:"permission",label:"菜单",colProps:{span:24},formItemProps:{slots:{default:()=>n(u,null,[n("div",{class:"flex w-full"},[n("div",{class:"flex-1"},[n(x,{ref:i,"show-checkbox":!0,"node-key":"name","highlight-current":!0,"default-checked-keys":r.value,"expand-on-click-node":!1,data:y.value,"onNode-click":k},null)])])])}}}]),j=s(),k=e=>{j.value=e},D=()=>{var e,a;return(null==(a=null==(e=f(i))?void 0:e.getCheckedNodes(!1,!0))?void 0:a.map((e=>e.code)))||[]},P=d({name:[t()],permission:[{required:!0,validator:(e,a,l)=>{D().length?l():l("请选择菜单")}}]}),{formRegister:I,formMethods:L}=A(),{setValues:z,getFormData:F,getElFormExpose:S}=L;return c((()=>o.currentRow),(e=>{e&&z(e)}),{deep:!0,immediate:!0}),a({submit:async()=>{const e=await S();if(await(null==e?void 0:e.validate())){const e=await F(),a=D();return e.permission=a||[],e}}}),(e,a)=>{const t=l;return p((m(),v(f(R),{rules:P,onRegister:f(I),schema:b.value},null,8,["rules","onRegister","schema"])),[[t,w.value]])}}}),F=r({__name:"roleDetail",props:{currentRow:{type:Object,default:()=>{}}},setup(e){let a=s(!1);const t=s(),o=s(),i=e=>{o.value=e},r=s([]);(async()=>{try{a.value=!0}catch(e){}finally{a.value=!1}})();const d=s([{field:"name",label:"角色名称"},{field:"remark",label:"备注",slots:{default:e=>e.remark||"-"}},{field:"permission",label:"菜单分配",span:24,slots:{default:()=>n(u,null,[n("div",{class:"flex w-full"},[n("div",{class:"flex-1"},[n(x,{ref:t,"node-key":"code","highlight-current":!0,"expand-on-click-node":!1,data:r.value,"onNode-click":i},null)])])])}}]);return(t,o)=>{const i=l;return m(),w("div",null,[p(n(f(D),{column:1,schema:d.value,data:e.currentRow||{}},null,8,["schema","data"]),[[i,f(a)]])])}}}),S=r({__name:"index",setup(l){const r=s({}),c=s(),{tableRegister:p,tableState:g,tableMethods:h}=a({fetchDataApi:async()=>{const{pageSize:a,currentPage:l}=g,t=await e.getRoleList({page:f(l),limit:f(a),...f(r)});return{list:t.items||[],total:t.total}},fetchDelApi:async()=>!!(await deleteRoleApi(c.value))}),{dataList:x,loading:R,total:A,currentPage:C,pageSize:D}=g,{getList:S,delList:U}=h,V=d([{field:"id",label:"ID",width:100},{field:"name",label:"角色名称",width:150},{field:"remark",label:"备注"},{field:"createdAt",label:"创建时间",width:250,formatter:e=>I(e.createdAt)},{field:"updatedAt",label:"更新时间",width:250,formatter:e=>I(e.updatedAt)},{field:"action",label:"操作",width:300,slots:{default:e=>{const a=e.row;return n(u,null,[n(L,{type:"primary",onClick:()=>G(a,"edit")},{default:()=>[y("编辑")]}),n(L,{type:"success",onClick:()=>G(a,"detail")},{default:()=>[y("详情")]}),n(L,{type:"danger",onClick:()=>O(e.row)},{default:()=>[y("删除")]})])}}}]),q=d([{field:"name",label:"角色名称",component:"Input"}]),N=e=>{r.value=e,S()},E=async()=>{try{const e=f($),a=await(null==e?void 0:e.submit());a&&(B.value=!0,"add"===J.value?(await addRoleApi(a),k.success("添加成功")):"edit"===J.value&&(await editRoleApi(a),k.success("修改成功")),S(),W.value=!1)}catch(e){}finally{B.value=!1}},H=s(!1),O=async e=>{c.value=Number(null==e?void 0:e.id),await U(c.value).finally((()=>{H.value=!1}))},W=s(!1),M=s(""),T=s(),J=s(""),$=s(),B=s(!1),G=(e,a)=>{M.value="edit"===a?"编辑":"详情",J.value=a,T.value=e,W.value=!0},K=()=>{M.value="添加",T.value=void 0,W.value=!0,J.value="add"};return(e,a)=>(m(),w("div",null,[n(i,{class:"m-3",title:"角色管理"},{action:_((()=>[n(L,{type:"primary",onClick:K},{default:_((()=>[y("新增")])),_:1})])),default:_((()=>[n(f(o),{schema:q,onReset:N,onSearch:N},null,8,["schema"]),n(f(t),{"current-page":f(C),"onUpdate:currentPage":a[0]||(a[0]=e=>b(C)?C.value=e:null),"page-size":f(D),"onUpdate:pageSize":a[1]||(a[1]=e=>b(D)?D.value=e:null),columns:V,"default-expand-all":"","node-key":"id",data:f(x),loading:f(R),pagination:{total:f(A)},onRegister:f(p)},null,8,["current-page","page-size","columns","data","loading","pagination","onRegister"])])),_:1}),n(P,{modelValue:W.value,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value=e),title:M.value,width:"600px"},{footer:_((()=>["detail"!==J.value?(m(),v(L,{key:0,type:"primary",loading:B.value,onClick:E},{default:_((()=>[y(" 保存 ")])),_:1},8,["loading"])):j("",!0),n(L,{onClick:a[2]||(a[2]=e=>W.value=!1)},{default:_((()=>[y("关闭")])),_:1})])),default:_((()=>["detail"!==J.value?(m(),v(z,{key:0,ref_key:"writeRef",ref:$,"current-row":T.value},null,8,["current-row"])):(m(),v(F,{key:1,"current-row":T.value},null,8,["current-row"]))])),_:1},8,["modelValue","title"])]))}});export{S as default};
